<!DOCTYPE html>
<html>
  <head>
    <title>Juego de la vida</title>
  </head>

  <body>
    <!--   CSS  -->

    <style>
      td {
        border: #eee solid 1px;
      }
    </style>

    <!--   HTML  -->

    <header>
      <h1>Game Of Life</h1>

      <br />
      <input type="button" onClick="random()" value="random" />
      <input
        type="button"
        onClick="intercambiarReproduccion()"
        value="Play/Stop"
      />
      <input
        type="button"
        onClick="estadoAnterior()"
        value="<<Estado anterior"
      />
      <input
        type="button"
        onClick="siguienteEstado()"
        value="siguiente Estado>>"
      />
    </header>

    <!-- HTML -->

    <div id="contenedor-tablero"></div>

    <!-- ************ARCHIVOS JS******** -->

    <script>
      let filas = Math.floor(Math.random() * 80 + 30),
        columnas = filas,
        lado = 20;

      //FUNCION PARA GENERAR UN TABLERO CON DIFERENTES NUMEROS DE CELDAS

      (function generarTablero() {
        let html = "<table cellpadding=0 cellspacing=0 id= 'tablero'>";

        for (let y = 0; y < filas; y++) {
          html += "<tr>";
          for (let x = 0; x < columnas; x++) {
            html += `<td id="celula-${
              x + "-" + y
            }" onclick ="cambiarEstado(${x},${y})">`;
            html += "</td>";
          }
          html += "</tr>";
        }

        html += "</table>";
        let contenedor = document.getElementById("contenedor-tablero");
        contenedor.innerHTML = html;
        let tablero = document.getElementById("tablero");
        tablero.style.width = lado * columnas + "px";
        tablero.style.height = lado * filas + "px";
      })();

      function cambiarEstado(x, y) {
        let celula = document.getElementById(`celula-${x + "-" + y}`);
        if (celula.style.background != "black") {
          celula.style.background = "black";
        } else {
          celula.style.background = "";
        }
      }

      function fotografiar() {
        fotografia = [];
        for (let x = 0; x < columnas; x++) {
          fotografia.push([]);
          for (let y = 0; y < columnas; y++) {
            let celula = document.getElementById(`celula-${x + "-" + y}`);
            fotografia[x][y] = celula.style.background == "black";
          }
        }
      }

      function contarVivas(x, y) {
            let vivas = 0
            for (let i = -1; i <= 1; i++) {
                for (let j = -1; j <= 1; j++) {
                    if (i == 0 && j == 0)
                        continue
                    try {
                        if (fotografia[x + i][y + j])
                            vivas++
                    } catch (e) { }
                    if (vivas > 3) {
                        return vivas
                    }
                }
            }
            return vivas
        }

        function siguienteEstado() {
            
            fotografiar()
            fotoAnterior = fotografia;
            for (let x = 0; x < columnas; x++) {
                for (let y = 0; y < columnas; y++) {
                    let vivas = contarVivas(x, y)
                    let celula = document.getElementById(`celula-${x + "-" + y}`)
                    if (fotografia[x][y]) {//celula esta viva
                        if (vivas < 2 || vivas > 3)
                            celula.style.background = "white"//muere por sobrepoblacion
                    } else {//celula esta muerta
                        if (vivas == 3)
                            celula.style.background = "black"
                    }
                }
            }

        }
    </script>
  </body>
</html>
